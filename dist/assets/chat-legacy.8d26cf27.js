!function(){function e(e,a,o,t,r,n,i){try{var d=e[n](i),p=d.value}catch(v){return void o(v)}d.done?a(p):Promise.resolve(p).then(t,r)}function a(e,a){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);a&&(t=t.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),o.push.apply(o,t)}return o}function o(e){for(var o=1;o<arguments.length;o++){var r=null!=arguments[o]?arguments[o]:{};o%2?a(Object(r),!0).forEach((function(a){t(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}function t(e,a,o){return(a=function(e){var a=function(e,a){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var t=o.call(e,a||"default");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(e)}(e,"string");return"symbol"==typeof a?a:String(a)}(a))in e?Object.defineProperty(e,a,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[a]=o,e}var r=document.createElement("style");r.innerHTML=':root{--van-divider-margin: var(--van-padding-md) 0;--van-divider-text-color: var(--van-text-color-2);--van-divider-font-size: var(--van-font-size-md);--van-divider-line-height: 24px;--van-divider-border-color: var(--van-border-color);--van-divider-content-padding: var(--van-padding-md);--van-divider-content-left-width: 10%;--van-divider-content-right-width: 10%}.van-divider{display:flex;align-items:center;margin:var(--van-divider-margin);color:var(--van-divider-text-color);font-size:var(--van-divider-font-size);line-height:var(--van-divider-line-height);border-color:var(--van-divider-border-color);border-style:solid;border-width:0}.van-divider:before,.van-divider:after{display:block;flex:1;box-sizing:border-box;height:1px;border-color:inherit;border-style:inherit;border-width:var(--van-border-width) 0 0}.van-divider:before{content:""}.van-divider--hairline:before,.van-divider--hairline:after{transform:scaleY(.5)}.van-divider--dashed{border-style:dashed}.van-divider--content-center:before,.van-divider--content-left:before,.van-divider--content-right:before{margin-right:var(--van-divider-content-padding)}.van-divider--content-center:after,.van-divider--content-left:after,.van-divider--content-right:after{margin-left:var(--van-divider-content-padding);content:""}.van-divider--content-left:before{max-width:var(--van-divider-content-left-width)}.van-divider--content-right:after{max-width:var(--van-divider-content-right-width)}.save-btn[data-v-408d33f5]{position:fixed;bottom:100px;right:30px;cursor:pointer;z-index:2000}.save-btn span[data-v-408d33f5]{color:#22ad72;font-size:12px;margin-top:-8px;transform:scale(.8)}.save-btn img[data-v-408d33f5]{width:50px;height:50px;animation:scale-animate-408d33f5 2.2s infinite;border-radius:100%;padding:8px;box-sizing:border-box}.save-btn img[data-v-408d33f5]:hover{background:#e6faf2}.name-container[data-v-408d33f5]{margin:30px 20px;border-bottom:1px solid #f1f1f1}@keyframes scale-animate-408d33f5{0%{transform:scale(.8);box-shadow:0 0 rgba(195,253,194,.6)}60%{transform:scale(1);box-shadow:0 0 0 30px rgba(37,199,36,0)}to{transform:scale(.8);box-shadow:0 0 rgba(30,190,30,0)}}.shadow-container[data-v-408d33f5]{position:fixed!important;left:0;top:0;z-index:10000;width:100%;height:100%;background:rgba(0,0,0,.3)}.shadow-container .shadow-box[data-v-408d33f5]{position:fixed!important;left:50%;top:46%;transform:translate(-50%,-50%);width:80%;height:140px;background:#fff;padding:20px 12px;box-sizing:border-box;border-radius:5px}.shadow-container .pwd[data-v-408d33f5]{width:100%;background:transparent}.shadow-container[data-v-408d33f5] .el-input__inner{background:#f1f5f4;border:none}.shadow-container[data-v-408d33f5] .el-input__inner:focus{border-color:#22ad72}.shadow-container .btns[data-v-408d33f5]{margin-top:25px}.shadow-container .btns[data-v-408d33f5] .el-button{width:40%;padding:8px 12px;min-height:auto}.shadow-container .btns[data-v-408d33f5] .el-button:nth-child(1):focus,.shadow-container .btns[data-v-408d33f5] .el-button:nth-child(1):hover{border-color:#22ad72;color:#22ad72;background-color:#e4f8f0}.shadow-container .btns[data-v-408d33f5] .el-button:nth-child(2){background:#22ad72;border:none}:root{--van-popover-arrow-size: 6px;--van-popover-radius: var(--van-radius-lg);--van-popover-action-width: 128px;--van-popover-action-height: 44px;--van-popover-action-font-size: var(--van-font-size-md);--van-popover-action-line-height: var(--van-line-height-md);--van-popover-action-icon-size: 20px;--van-popover-light-text-color: var(--van-text-color);--van-popover-light-background: var(--van-background-2);--van-popover-light-action-disabled-text-color: var(--van-text-color-3);--van-popover-dark-text-color: var(--van-white);--van-popover-dark-background: #4a4a4a;--van-popover-dark-action-disabled-text-color: var(--van-text-color-2)}.van-popover{position:absolute;overflow:visible;background-color:transparent;transition:opacity .15s,transform .15s}.van-popover__wrapper{display:inline-block}.van-popover__arrow{position:absolute;width:0;height:0;border-color:transparent;border-style:solid;border-width:var(--van-popover-arrow-size)}.van-popover__content{overflow:hidden;border-radius:var(--van-popover-radius)}.van-popover__action{position:relative;display:flex;align-items:center;box-sizing:border-box;width:var(--van-popover-action-width);height:var(--van-popover-action-height);padding:0 var(--van-padding-md);font-size:var(--van-popover-action-font-size);line-height:var(--van-line-height-md);cursor:pointer}.van-popover__action:last-child .van-popover__action-text:after{display:none}.van-popover__action-text{display:flex;flex:1;align-items:center;justify-content:center;height:100%}.van-popover__action-icon{margin-right:var(--van-padding-xs);font-size:var(--van-popover-action-icon-size)}.van-popover__action--with-icon .van-popover__action-text{justify-content:flex-start}.van-popover[data-popper-placement^=top] .van-popover__arrow{bottom:0;border-top-color:currentColor;border-bottom-width:0;margin-bottom:calc(var(--van-popover-arrow-size) * -1)}.van-popover[data-popper-placement=top]{transform-origin:50% 100%}.van-popover[data-popper-placement=top] .van-popover__arrow{left:50%;transform:translate(-50%)}.van-popover[data-popper-placement=top-start]{transform-origin:0 100%}.van-popover[data-popper-placement=top-start] .van-popover__arrow{left:var(--van-padding-md)}.van-popover[data-popper-placement=top-end]{transform-origin:100% 100%}.van-popover[data-popper-placement=top-end] .van-popover__arrow{right:var(--van-padding-md)}.van-popover[data-popper-placement^=left] .van-popover__arrow{right:0;border-right-width:0;border-left-color:currentColor;margin-right:calc(var(--van-popover-arrow-size) * -1)}.van-popover[data-popper-placement=left]{transform-origin:100% 50%}.van-popover[data-popper-placement=left] .van-popover__arrow{top:50%;transform:translateY(-50%)}.van-popover[data-popper-placement=left-start]{transform-origin:100% 0}.van-popover[data-popper-placement=left-start] .van-popover__arrow{top:var(--van-padding-md)}.van-popover[data-popper-placement=left-end]{transform-origin:100% 100%}.van-popover[data-popper-placement=left-end] .van-popover__arrow{bottom:var(--van-padding-md)}.van-popover[data-popper-placement^=right] .van-popover__arrow{left:0;border-right-color:currentColor;border-left-width:0;margin-left:calc(var(--van-popover-arrow-size) * -1)}.van-popover[data-popper-placement=right]{transform-origin:0 50%}.van-popover[data-popper-placement=right] .van-popover__arrow{top:50%;transform:translateY(-50%)}.van-popover[data-popper-placement=right-start]{transform-origin:0 0}.van-popover[data-popper-placement=right-start] .van-popover__arrow{top:var(--van-padding-md)}.van-popover[data-popper-placement=right-end]{transform-origin:0 100%}.van-popover[data-popper-placement=right-end] .van-popover__arrow{bottom:var(--van-padding-md)}.van-popover[data-popper-placement^=bottom] .van-popover__arrow{top:0;border-top-width:0;border-bottom-color:currentColor;margin-top:calc(var(--van-popover-arrow-size) * -1)}.van-popover[data-popper-placement=bottom]{transform-origin:50% 0}.van-popover[data-popper-placement=bottom] .van-popover__arrow{left:50%;transform:translate(-50%)}.van-popover[data-popper-placement=bottom-start]{transform-origin:0 0}.van-popover[data-popper-placement=bottom-start] .van-popover__arrow{left:var(--van-padding-md)}.van-popover[data-popper-placement=bottom-end]{transform-origin:100% 0}.van-popover[data-popper-placement=bottom-end] .van-popover__arrow{right:var(--van-padding-md)}.van-popover--light{color:var(--van-popover-light-text-color)}.van-popover--light .van-popover__content{background:var(--van-popover-light-background);box-shadow:0 2px 12px rgba(50,50,51,.12)}.van-popover--light .van-popover__arrow{color:var(--van-popover-light-background)}.van-popover--light .van-popover__action:active{background-color:var(--van-active-color)}.van-popover--light .van-popover__action--disabled{color:var(--van-popover-light-action-disabled-text-color);cursor:not-allowed}.van-popover--light .van-popover__action--disabled:active{background-color:transparent}.van-popover--dark{color:var(--van-popover-dark-text-color)}.van-popover--dark .van-popover__content{background:var(--van-popover-dark-background)}.van-popover--dark .van-popover__arrow{color:var(--van-popover-dark-background)}.van-popover--dark .van-popover__action:active{background-color:rgba(0,0,0,.2)}.van-popover--dark .van-popover__action--disabled{color:var(--van-popover-dark-action-disabled-text-color)}.van-popover--dark .van-popover__action--disabled:active{background-color:transparent}.van-popover--dark .van-popover__action-text:after{border-color:var(--van-gray-7)}.van-popover-zoom-enter-from,.van-popover-zoom-leave-active{transform:scale(.8);opacity:0}.van-popover-zoom-enter-active{transition-timing-function:var(--van-ease-out)}.van-popover-zoom-leave-active{transition-timing-function:var(--van-ease-in)}.nav[data-v-12f7047c]{position:fixed;top:0;left:0;width:100%;z-index:10;background-color:#fff}.nav[data-v-12f7047c] .van-search__action{line-height:normal}.nav .search-btn[data-v-12f7047c]{width:70px}.nav .select[data-v-12f7047c]{padding:0 15px;line-height:20px;font-size:14px;text-align:right}.desc[data-v-12f7047c]{width:150px;line-height:20px;font-size:12px;padding:10px}.list-contaner[data-v-12f7047c]{margin-top:10px}.title[data-v-6bd17b21]{margin:60px 0 20px;text-align:center;font-size:24px;color:#000;font-weight:800}.desc[data-v-6bd17b21]{padding:10px 10px 20px;color:#b8b8b8;font-size:14px}.msg-list .msg-item:last-child .a-content span[data-v-608e3d8f]{margin-right:2px}html[data-v-608e3d8f]::-webkit-scrollbar{width:30px;height:30px}html[data-v-608e3d8f]::-webkit-scrollbar-thumb{background:-webkit-gradient(linear,left top,left bottom,from(#ff8a00),to(#e52e71));background:linear-gradient(180deg,#ff8a00,#e52e71);border-radius:30px;box-shadow:inset 2px 2px 2px rgba(255,255,255,.25),inset -2px -2px 2px rgba(0,0,0,.25)}html[data-v-608e3d8f]::-webkit-scrollbar-track{background:linear-gradient(90deg,#201c29,#201c29 1px,#100e17 0,#100e17)}.box[data-v-608e3d8f]{height:100%}[data-v-608e3d8f] .van-divider{font-size:8px;margin:auto}.container[data-v-608e3d8f]{position:relative;width:100%;height:100%;background:#fff;padding:60px 3px 100px;box-sizing:border-box}.container .loading[data-v-608e3d8f]{position:absolute;left:1%;top:1.5%;width:98%;height:98%;background:transparent}.container .loading img[data-v-608e3d8f]{position:absolute;left:50%;top:40%;transform:translate(-50%,-50%);height:40px;border-radius:100%}.container .msg-list[data-v-608e3d8f]{overflow:scroll;width:100%;height:100%;padding:0 8px 60px;box-sizing:border-box}.q-box[data-v-608e3d8f]{position:relative;font-size:15px;margin:10px 0}.q-box .avatar[data-v-608e3d8f]{width:38px;height:38px;margin-right:10px}.q-box .q-content[data-v-608e3d8f]{padding:10px 8px;box-sizing:border-box;border-radius:8px;width:70%;font-size:14px;text-align:justify;background:#f1f5f4;color:#000}.q-box .icon-edit[data-v-608e3d8f]{margin:5px 0 0 5px;padding:2px}.q-box .icon-edit[data-v-608e3d8f]:hover{background:#f1f5f4;border-radius:2px}.q-box[data-v-608e3d8f] .el-textarea__inner{background:transparent;border:none;color:#000;padding:0;resize:none;box-shadow:none}.q-box[data-v-608e3d8f] .el-textarea__inner:focus{border-color:#22ad72}.q-box .q-btns[data-v-608e3d8f]{position:absolute;left:18%;bottom:-32px}.q-box .q-btns[data-v-608e3d8f] .el-button{padding:5px 12px;min-height:auto}.q-box .q-btns[data-v-608e3d8f] .el-button:nth-child(1):focus,.q-box .q-btns[data-v-608e3d8f] .el-button:nth-child(1):hover{border-color:#22ad72;color:#22ad72;background-color:#e4f8f0}.q-box .q-btns[data-v-608e3d8f] .el-button:nth-child(2){background:#22ad72;border:none}.a-box[data-v-608e3d8f]{width:100%;margin:15px 0}.a-box .a-box-item-box[data-v-608e3d8f]{width:86%}.a-box .a-box-item-box .a-box-item[data-v-608e3d8f]{width:100%}.a-box .a-box-item-box .a-box-item .source[data-v-608e3d8f]{background-color:#fff;border-radius:5px;padding:8px;margin-top:10px;line-height:20px;font-size:10px;color:#1397fd}.a-box .a-box-item-box .a-box-item .source .title[data-v-608e3d8f]{color:#000;font-weight:800;padding:0 0 5px}.a-box .a-box-item-box .a-box-item .source>li[data-v-608e3d8f]:hover{text-decoration:underline;cursor:pointer}.a-box .a-box-item-box .a-box-item .source li[data-v-608e3d8f]{list-style-type:disc;margin-left:15px}.a-box .avatar[data-v-608e3d8f]{width:38px;height:38px}.a-box .a-content[data-v-608e3d8f]{display:inline-block;max-width:100%;background:#22ad72;color:#fff;padding:10px 8px;box-sizing:border-box;border-radius:8px;font-size:13px;text-align:justify;margin-right:10px}.a-box .loading-con[data-v-608e3d8f]{text-align:right}.a-box .loading-con .a-content2[data-v-608e3d8f]{display:inline-block}.a-box .like-box[data-v-608e3d8f]{width:100%;padding:5px 10px 0 0;box-sizing:border-box}.a-box .like-box .agree[data-v-608e3d8f]{margin-right:10px}.a-box .like-box .selected[data-v-608e3d8f]{background:#f1f5f4;border-radius:5px}.input-container[data-v-608e3d8f]{border-top:dashed 1px #dbf7eb;width:100%;display:flex;align-items:center;justify-content:center;padding:10px 0;position:absolute;bottom:0;left:0;background:#fff;background:rgba(241,245,244,.2784313725);z-index:1000}.input-box[data-v-608e3d8f]{width:95%;border:solid 1px #f0f0f0;border-radius:2px}.input-box[data-v-608e3d8f] .el-textarea textarea{padding-top:12px!important;padding-bottom:12px!important}.input-box .icon-send[data-v-608e3d8f]{box-sizing:border-box;height:44px;z-index:1;margin-left:-40px}.input-box .icon-send img[data-v-608e3d8f]{padding:2px;width:26px;height:26px}.input-box .icon-send img.sendmsg[data-v-608e3d8f]:hover{background:#f1f5f4;border-radius:2px}.input-box[data-v-608e3d8f] .el-textarea__inner{padding-right:50px;padding-top:8px;padding-bottom:8px;box-shadow:rgba(100,100,111,.2) 0 7px 29px;border:none;resize:none}.input-box[data-v-608e3d8f] .el-textarea__inner:focus{border-color:#22ad72}.input-box[data-v-608e3d8f] .el-input__inner{padding-right:50px}.input-box[data-v-608e3d8f] .el-input__inner:focus{border-color:#22ad72}[data-v-608e3d8f] .typed-cursor{opacity:1;-webkit-animation:typedjsBlink-608e3d8f .7s infinite;animation:typedjsBlink-608e3d8f .7s infinite}@keyframes typedjsBlink-608e3d8f{50%{opacity:0}}@-webkit-keyframes typedjsBlink-608e3d8f{0%{opacity:1}50%{opacity:0}to{opacity:1}}.typed-fade-out[data-v-608e3d8f]{opacity:0;transition:opacity .25s;-webkit-animation:0;animation:0}.isNoneTyped[data-v-608e3d8f]{display:inline-block;height:14px;opacity:0;overflow:hidden}.scroll-tips[data-v-608e3d8f]{color:#999;font-size:12px;transform:scale(.9);width:100%;text-align:center;padding:3px 0}.header[data-v-608e3d8f]{position:absolute;top:0;left:0;width:100%;height:44px;line-height:44px;font-size:14px;background:#fff;border-bottom:solid 5px #f0f0f0;text-align:center;font-weight:700;color:#22ad72}.header .header-content[data-v-608e3d8f]{height:100%;padding:0 10px}.header .header-content .history[data-v-608e3d8f]{font-size:12px;color:#999}.header .header-content .add[data-v-608e3d8f]{font-size:12px}.header .header-content .add .el-icon[data-v-608e3d8f]{margin-right:2px}\n',document.head.appendChild(r),System.register(["./index-legacy.77e40bdf.js","./index-legacy.1dcd6f78.js","./index-legacy.e4e3e25f.js","./index-legacy.c9537be7.js","./LoadingMore.vue_vue_type_style_index_0_scoped_true_lang-legacy.62f8c4c3.js","./index-legacy.f25f109a.js","./index-legacy.fffc75e3.js","./index-legacy.f25f109a2.js"],(function(a){"use strict";var t,r,n,i,d,p,v,l,c,s,f,b,g,x,u,h,m,w,_,k;return{setters:[function(e){t=e.s,r=e.H,n=e._,i=e.r,d=e.c,p=e.ad,v=e.z,l=e.x,c=e.Q,s=e.P,f=e.L,b=e.f,g=e.M,x=e.v},function(e){u=e.s},function(){},function(e){h=e.c,m=e.t,w=e.m,_=e.w,e.I},function(e){k=e._},function(){},function(){},function(){}],execute:function(){const[y,z]=h("divider"),j={dashed:Boolean,hairline:m,contentPosition:w("center")};var q=t({name:y,props:j,setup:(e,{slots:a})=>()=>{var o;return r("div",{role:"separator",class:z({dashed:e.dashed,hairline:e.hairline,[`content-${e.contentPosition}`]:!!a.default})},[null==(o=a.default)?void 0:o.call(a)])}});_(q);const P=t({__name:"chat",setup(a){let t=c(),r=s();const{appContext:n}=f(),h=n.config.globalProperties;let m=i(!1);i(!1);let w=i();const _=()=>{b((()=>{setTimeout((()=>{var e,a,o;null!==(e=w.value)&&void 0!==e&&e.scrollHeight&&w.value.scrollTop+w.value.clientHeight!==(null===(a=w.value)||void 0===a?void 0:a.scrollHeight)&&(w.value.scrollTop=null===(o=w.value)||void 0===o?void 0:o.scrollHeight)}))}))},y=i([]),z=e=>{const a={readonly:!0};return Array.isArray(e)?e.map((e=>o(o({},e),a))):[o(o({},e),a)]};let j=i([]),q=i(!1),P=i("");k.throttle((()=>{P.value.length<0?u("请输入问题"):D()}),1500,{trailing:!1});let O=i(r.query.sessionId||"");const S=i(!1);d((()=>m.value||S.value));let I=i(1),T=i(1);i(1);const H=function(){var a,o=(a=function*(){j.value=[],O.value="",I.value=1,yield new Promise(((e,a)=>{h.axios.post(h.$api.createSession).then((o=>{const{data:r,code:n,msg:i}=o.data;0==n?(u("新聊天创建成功"),O.value=r.sessionId,e(O.value)):(u(i),setTimeout((()=>{t.replace("/v2/login")}),1e3),a())}))})),O.value&&B()},function(){var o=this,t=arguments;return new Promise((function(r,n){var i=a.apply(o,t);function d(a){e(i,r,n,d,p,"next",a)}function p(a){e(i,r,n,d,p,"throw",a)}d(void 0)}))});return function(){return o.apply(this,arguments)}}();p((()=>{r.query.sessionId?(()=>{m.value=!0;let e={sessionId:O.value,page:I.value};new Promise(((a,o)=>{h.axios.post(h.$api.loadSession,e).then((e=>{const{data:t,code:r,msg:n}=e.data;if(0==r){var i;let e=null===(i=w.value)||void 0===i?void 0:i.scrollHeight;j.value=z(t.data).reverse().concat(j.value),b((()=>{var a;w.value.scrollTop=(null===(a=w.value)||void 0===a?void 0:a.scrollHeight)-e-157})),S.value=t.totalPage<=I.value,T.value=t.totalPage,1===I.value&&_(),a(t)}else u(n),o()})).finally((()=>{m.value=!1}))}))})():H()}));const C=i(),A=i(!1),B=e=>{console.log("initWebSocket",A.value),A.value?e&&e():(C.value=new WebSocket("ws://"+g.wsUrl),A.value=!0,C.value.onopen=()=>{console.log("建立连接"),e&&e()},E(),N(),U())},D=()=>{q.value=!1;var e={chatAsk:P.value,sessionId:O.value,token:v.state.user.token,knowledgeIds:y.value.length>0?y.value:""};let a={basis:[],chatAsk:P.value,modelReply:"",modelVersion:"",replyTag:"",sessionId:O.value,time:"",uniqueId:"",knowledgeUsed:y.value};j.value[j.value.length]=z(a)[0],B((()=>{var a;null===(a=C.value)||void 0===a||a.send(JSON.stringify(e)),P.value=""}))},E=()=>{if(!C.value)return;let e="";C.value.onmessage=function(a){const o=JSON.parse(a.data.replace(/'/g,'"'));0===o.code&&0===o.data.isFinash&&(e+=o.data.data,j.value[j.value.length-1].modelReply=e),0===o.code&&1===o.data.isFinash&&(j.value[j.value.length-1]=z(o.data.data)[0],(()=>{let e={knowledgeIds:j.value[j.value.length-1].knowledgeUsed,query:j.value[j.value.length-1].chatAsk};new Promise(((a,o)=>{h.axios.post(h.$api.knowledgeUsed,e).then((e=>{const{data:a,code:o,msg:t}=e.data;j.value[j.value.length-1].basis=a}))}))})()),_()}},N=()=>{C.value&&(C.value.onclose=function(e){A.value=!1,console.log("连接关闭")})},U=()=>{C.value&&(C.value.onerror=function(e){var a;A.value=!1,null===(a=C.value)||void 0===a||a.close(),C.value=null,console.log(e)})};return(e,a)=>(x("el-input"),x("el-icon"),x("el-button"),l("",!0))}});a("default",n(P,[["__scopeId","data-v-608e3d8f"]]))}}}))}();
