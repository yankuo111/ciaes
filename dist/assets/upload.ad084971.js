import{_ as O,s as H,r as u,v as m,Y as se,A as ue,B as i,o as A,l as B,H as t,T as p,a4 as K,x as T,y as I,C as ie,L as G,z as de,p as J,m as Q,q as n,G as M,U as ce,V as re,W as pe,a1 as Y,a5 as _e,a2 as fe,a6 as me,F as ge,Q as ve,a3 as he}from"./index.8c5864de.js";const L=g=>(J("data-v-11c1ff0c"),g=g(),Q(),g),ye=L(()=>n("div",{class:"el-upload__text"},[I("\u5C06\u5236\u5EA6\u6587\u4EF6\u62D6\u5230\u6B64\u5904\uFF0C\u6216"),n("em",null,"\u70B9\u51FB\u4E0A\u4F20")],-1)),we=L(()=>n("div",{class:"el-upload__tip"},"\u652F\u6301\u4E0A\u4F20wps/doc/docx/pdf/zip/gz/gd/ofd\u7B49\u6587\u4EF6",-1)),Fe={key:0,class:"el-upload-title"},be=L(()=>n("span",null,"\u6587\u4EF6\u540D\u79F0",-1)),Ce=[be],Ee={key:1,class:"button-upload"},xe=H({__name:"UploadComponent",emits:["uploadFinished"],setup(g,{emit:E}){const{appContext:$}=G(),v=$.config.globalProperties;let e=u([]),k=u(null);const w=(s,o)=>{if(console.log(s,o),e.value.some(_=>_.name==s.name)){v.$message({message:s.name+" \u5DF2\u5B58\u5728",type:"warning"}),k.value.uploadFiles.splice(k.value.uploadFiles.length-1,1);return}e.value.push(s)},x=(s,o)=>{e.value=o},U=()=>{if(e.value.length===0){v.$message({message:"\u4E0A\u4F20\u6587\u4EF6\u4E0D\u80FD\u4E3A\u7A7A",type:"warning"});return}D()};let h=u(!1),y=u(0);const D=()=>{h.value=!0;let s=new FormData;for(let o=0;o<e.value.length;o++)console.log(e.value[o].raw),s.append("file",e.value[o].raw);s.append("token",de.state.user.token),s.append("knowledgeId",v.$route.query.id||""),v.axios.post(v.$api.uploadFile,s,{headers:{"Content-Type":"multipart/form-data"},timeout:6e5,transformRequest:[function(o){return o}]}).then(o=>{h.value=!1;let{code:b,msg:_}=o.data;b==0?(y.value=0,e.value=[],v.$message.success("\u6587\u4EF6\u4E0A\u4F20\u6210\u529F"),E("uploadFinished")):v.$message({message:_,type:"warning"})}).catch(()=>{h.value=!1})};return(s,o)=>{const b=m("el-icon"),_=m("el-upload"),R=m("el-button"),V=se("loading");return ue((A(),B("div",{class:ie([{"container-padding":i(e).length>0},"container"])},[t(_,{ref_key:"upload",ref:k,class:"upload",drag:"",multiple:"",action:"customize","auto-upload":!1,"on-change":w,"on-remove":x,"show-file-list":!0,"file-list":i(e),accept:".wps,.doc,.docx,.pdf,.zip,.gz"},{default:p(()=>[t(b,{size:60,color:"#409eff",style:{"margin-bottom":"15px"}},{default:p(()=>[t(i(K))]),_:1}),ye,we]),_:1},8,["file-list"]),i(e).length>0?(A(),B("div",Fe,Ce)):T("",!0),i(e).length>0?(A(),B("div",Ee,[t(R,{class:"btn1 btn default-primary",type:"primary",onClick:U},{default:p(()=>[t(b,null,{default:p(()=>[t(i(K))]),_:1}),I(" \u7ACB\u5373\u4E0A\u4F20 ")]),_:1})])):T("",!0)],2)),[[V,i(h)]])}}});var $e=O(xe,[["__scopeId","data-v-11c1ff0c"]]);const N=g=>(J("data-v-09b2e8b8"),g=g(),Q(),g),ke={class:"knowledge"},De={key:0,class:"knowledge-title"},Ae=N(()=>n("span",null,"\u77E5\u8BC6\u5E93\u540D\u79F0: ",-1)),Be={class:"header flex flex_between"},Ie={class:"flex flex_center"},qe={class:"content"},Se=N(()=>n("span",null,"\u6682\u65E0\u6570\u636E\uFF0C\u8FD4\u56DE",-1)),Ue=N(()=>n("span",null,"\u9009\u62E9",-1)),Re=H({__name:"upload",setup(g){const E=u(""),$=u(!1),{appContext:v}=G(),e=v.config.globalProperties,k=ve(),w=u(1),x=u([]),U=e.$common.DateFormat,h=u(0),y=u(!1),D=u(!1),s=u(e.$route.query.type||""),o=u(e.$route.query.name||""),b=u(),_=u([]),R=l=>{_.value=l,console.log(l)},V=({columnIndex:l})=>{if(l===0&&s.value==="public"||l===0&&!e.$route.query.id)return"seltAllbtnDis"},q=()=>(y.value=!0,D.value=!1,new Promise((l,a)=>{e.axios.post(e.$api.listKnowledgeFile,{page:w.value,knowledgeId:e.$route.query.id||""}).then(C=>{const{data:d,code:c,msg:r}=C.data;c==0?(x.value=d.data,h.value=d.totalCount):e.$message.error(r)}).finally(()=>{y.value=!1})}));q();const W=()=>{w.value=1,q()},z=()=>(y.value=!0,new Promise((l,a)=>{e.axios.post(e.$api.searchKnowledgeFile,{page:w.value,query:E.value,knowledgeId:e.$route.query.id||""}).then(C=>{const{data:d,code:c,msg:r}=C.data;c==0?(x.value=d.data,h.value=d.totalCount):e.$message.error(r)}).finally(()=>{y.value=!1})})),X=()=>{!E.value||(x.value=[],h.value=0,w.value=1,D.value=!0,z())},Z=l=>{w.value=l,P()},P=()=>{D.value?z():q()},ee=l=>l+1+(w.value-1)*10,le=l=>{let a=e.$router.resolve({path:"/v2/knowledge/details",query:{knowledgeId:e.$route.query.id,fileId:l._id,name:l.policyName}});window.open(a.href,"_bank")},te=()=>{y.value=!0;let l=_.value.map(a=>a._id);return new Promise((a,C)=>{e.axios.post(e.$api.delFile,{knowledgeId:e.$route.query.id,policy_id:JSON.stringify(l)}).then(d=>{const{data:c,code:r,msg:f}=d.data;r==0?(e.$message.success("\u5220\u9664\u6210\u529F"),P()):e.$message.error(f)}).finally(()=>{y.value=!1})})},ae=()=>{let l=_.value.map(a=>a.sourceFile);return new Promise((a,C)=>{e.axios.post(e.$api.downloadFile,{knowledgeId:e.$route.query.id,ids:JSON.stringify(l)},{responseType:"blob"}).then(d=>{const c=d.data,r=new Blob([c],{type:d.data.type}),f=document.createElement("a"),S=window.URL.createObjectURL(r);f.href=S,l.length>1?f.download=decodeURI(e.$route.query.name+".zip"):f.download=decodeURI(l[0].fileName),document.body.appendChild(f),f.click(),document.body.removeChild(f),window.URL.revokeObjectURL(S)}).finally(()=>{y.value=!1})})},j=l=>{l==="delete"?he.confirm("\u60A8\u5C06\u5220\u9664\u6B64\u77E5\u8BC6\u5E93\uFF0C\u662F\u5426\u7EE7\u7EED?","\u6E29\u99A8\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{te()}):l==="download"&&ae()},oe=()=>{k.push({path:"/v2/knowledge/index"})};return(l,a)=>{const C=m("el-icon"),d=m("el-input"),c=m("el-button"),r=m("el-table-column"),f=m("el-table"),S=m("el-pagination"),ne=m("el-dialog");return A(),B(ge,null,[n("div",ke,[o.value?(A(),B("div",De,[Ae,n("span",null,M(o.value),1)])):T("",!0),n("div",Be,[n("div",Ie,[n("div",null,[t(d,{modelValue:E.value,"onUpdate:modelValue":a[0]||(a[0]=F=>E.value=F),class:"search-input",placeholder:"\u6587\u4EF6\u641C\u7D22"},{prefix:p(()=>[t(C,{class:"el-input__icon"},{default:p(()=>[t(i(ce))]),_:1})]),_:1},8,["modelValue"]),t(c,{class:"default-primary",type:"primary",icon:i(re),onClick:X},{default:p(()=>[I(" \u641C\u7D22")]),_:1},8,["icon"]),t(c,{class:"default-primary-plain",icon:i(pe),onClick:q},{default:p(()=>[I("\u91CD\u5236")]),_:1},8,["icon"])])]),n("div",null,[t(c,{type:"primary",onClick:a[1]||(a[1]=Y(F=>j("download"),["stop"])),disabled:_.value.length===0,icon:i(_e),circle:""},null,8,["disabled","icon"]),t(c,{type:"danger",icon:i(fe),onClick:a[2]||(a[2]=Y(F=>j("delete"),["stop"])),disabled:_.value.length===0,circle:""},null,8,["icon","disabled"]),t(c,{class:"default-primary",type:"primary",onClick:a[3]||(a[3]=F=>$.value=!0),icon:i(me),disabled:s.value==="public"||!i(e).$route.query.id,circle:""},null,8,["icon","disabled"])])]),n("div",qe,[t(f,{ref_key:"multipleTableRef",ref:b,"cell-style":{textAlign:"center"},stripe:"",class:"table","header-cell-style":{"text-align":"center"},data:x.value,onRowClick:le,onSelectionChange:R,"header-cell-class-name":V},{empty:p(()=>[n("div",null,[Se,n("span",{onClick:oe,style:{color:"#409eff",cursor:"pointer",margin:"0 2px"}},"\u77E5\u8BC6\u5E93\u5217\u8868"),Ue])]),default:p(()=>[t(r,{type:"selection",selectable:()=>s.value!=="public",width:"55"},null,8,["selectable"]),t(r,{type:"index",index:ee,width:"100",label:"\u5E8F\u53F7"}),t(r,{property:"sourceFile.fileName",label:"\u5236\u5EA6\u540D\u79F0"}),t(r,{label:"\u4E0A\u4F20\u65F6\u95F4"},{default:p(F=>[I(M(i(U)("YYYY-mm-dd HH:MM:SS",F.row.createTime)),1)]),_:1})]),_:1},8,["data"]),t(S,{class:"pagination flex_just",background:"",layout:"total,prev, pager, next",onCurrentChange:Z,"hide-on-single-page":"",total:h.value},null,8,["total"])])]),t(ne,{modelValue:$.value,"onUpdate:modelValue":a[4]||(a[4]=F=>$.value=F),title:"\u6587\u4EF6\u4E0A\u4F20",width:"40%"},{default:p(()=>[t($e,{onUploadFinished:W})]),_:1},8,["modelValue"])],64)}}});var Te=O(Re,[["__scopeId","data-v-09b2e8b8"]]);export{Te as default};
